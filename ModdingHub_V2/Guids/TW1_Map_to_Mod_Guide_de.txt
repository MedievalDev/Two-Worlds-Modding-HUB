================================================================================
  TWO WORLDS 1 — Map zu Mod Konvertierung (Kompakt-Anleitung)
================================================================================

ÜBERSICHT
─────────
Selbst erstellte Maps aus dem TwoWorlds Editor liegen als Saves vor.
Damit das Spiel sie als Mod laden kann, müssen sie in ein .wd-Archiv
gepackt und in der Windows-Registry aktiviert werden.

Kurzfassung des Ablaufs:

  Editor-Map  →  PhysX kochen  →  LevelHeaders generieren
             →  Dateien kopieren & umbenennen  →  .wd packen
             →  Registry aktivieren  →  Neues Spiel starten


VORAUSSETZUNGEN
───────────────
• TwoWorldsSDK (z.B. unter C:\Games\TwoWorldsSDK\)
• Two Worlds Epic Edition (Steam oder standalone)
• Buglords Tools: wdio.py (WD-Packer), TwoWorlds1 Mod Selector
• Python 3.10+ (für wdio.py)


ORDNERSTRUKTUR
──────────────
SDK:
  TwoWorldsSDK\
  ├── TwoWorldsEditor.exe
  ├── Tools\
  │   ├── MeshParamsGen.exe
  │   ├── LevelHeadersCacheGen.bat
  │   └── tw_editor_cmd_injector.py   ← Unser Tool
  └── Levels\

Spiel:
  Two Worlds - Epic Edition\
  ├── TwoWorlds.exe
  ├── TwoWorlds1 Mod Selector.exe     ← Buglords Mod-Aktivierer
  └── Mods\                           ← Großes M!
      └── MeinMod.wd

Saves:
  %USERPROFILE%\Saved Games\Two Worlds Saves\
  └── Levels\
      ├── Map_F01s.bmp                ← Minimap-Bild
      ├── Map_F01s.lnd                ← Terrain + Objekte + Spawns
      └── Physic\
          └── Map_F01s.phx            ← Kollisionsdaten


SCHRITT 1 — PhysX kochen (im Editor)
─────────────────────────────────────
Im Editor die Konsole öffnen (Taste C) und nacheinander eingeben:

  editor.cookphysx.mode geomipmap
  editor.cookphysx.strength = 1.0
  editor.cookphysx.overwrite = 1
  editor.cookphysx.pc out

Warten bis der Cook-Vorgang abgeschlossen ist.
Die .phx-Datei wird in den Saves/Physic-Ordner geschrieben.

WICHTIG: Die .phx-Datei darf NICHT komprimiert werden!
Alte/andere WD-Packer komprimieren .phx-Dateien → Spiel-Crash.
Deshalb nur Buglords wdio.py oder seinen WD-Repacker verwenden.


SCHRITT 2 — LevelHeaders generieren
────────────────────────────────────
Die Datei LevelHeadersCacheGen.bat im Tools-Ordner ausführen.
Sie ruft intern auf:

  MeshParamsGen.exe "C:\Games\TwoWorlds/>" -levelheaderscache
    "Levels\Map_*.lnd" "Levels\Map_LevelHeaders.lhc"

Der Pfad in der BAT muss zum eigenen Spielverzeichnis passen!
Ergebnis: Map_LevelHeaders.lhc wird erzeugt (Index aller Maps).
Diese Datei muss nach JEDER Map-Änderung neu generiert werden.


SCHRITT 3 — Mod-Ordner vorbereiten
───────────────────────────────────
Im Mods-Ordner des Spiels folgende Struktur erstellen:

  Mods\
  └── MeinMod\              ← Frei wählbarer Name
      └── Levels\
          ├── Map_F01.lnd
          ├── Map_F01.bmp
          ├── Map_LevelHeaders.lhc
          └── Physic\
              └── Map_F01.phx

WICHTIG — Dateien umbenennen!
  Editor speichert:  Map_F01s.lnd,  Map_F01s.bmp,  Map_F01s.phx
  Mod braucht:       Map_F01.lnd,   Map_F01.bmp,   Map_F01.phx

Das "s" (und alles nach den ersten 2 Ziffern) muss weg!
Die Namen müssen exakt den Vanilla-Dateinamen entsprechen,
da das WD-Archiv die Originaldateien im Spiel überschreibt.

Quellen der Dateien:
  .bmp + .lnd  →  aus Saves\Levels\
  .phx         →  aus Saves\Levels\Physic\
  .lhc         →  aus SDK\Levels\ oder Spiel\Levels\


SCHRITT 4 — In .wd-Archiv packen
─────────────────────────────────
Mit Buglords wdio.py (Version 1 = TW1-Format 0x200):

  python wdio.py pack -v 1 -o "Mods\MeinMod" "Mods\MeinMod.wd"

Quelle (source)  = Der Ordner mit Levels\ + Physic\
Ziel (dest)      = Die fertige .wd-Datei

Alternativ: Buglords Tw1WDRepacker.exe (GUI-Tool)
  Source:      Ordner "MeinMod" auswählen (NICHT die .wd!)
  Destination: Mods-Ordner
  → Pack klicken

Der Ordnername wird zum .wd-Dateinamen.
Die .wd-Datei muss im Mods-Ordner des Spiels liegen.

Hinweis: .phx-Dateien werden groß — für Tester ggf. externe
Filesharing-Dienste statt Discord (8 MB Limit) nutzen.


SCHRITT 5 — Mod aktivieren (Registry)
──────────────────────────────────────
Two Worlds 1 nutzt die Windows-Registry um Mods ein/auszuschalten:

  Pfad:  HKEY_CURRENT_USER\SOFTWARE\Reality Pump\TwoWorlds\Mods
  Wert:  <dateiname>.wd  (z.B. "MeinMod.wd")
  Typ:   REG_DWORD
  Daten: 1 = aktiv, 0 = inaktiv

Einfachste Methode: Buglords "TwoWorlds1 Mod Selector.exe"
  → Muss im Spielverzeichnis liegen (neben TwoWorlds.exe)
  → Sucht automatisch .wd-Dateien im Mods-Ordner
  → Rot = inaktiv, Enter drücken → Grün = aktiv

Alternativ: Manuell über regedit oder per Python-Script:

  import winreg
  key = winreg.CreateKey(winreg.HKEY_CURRENT_USER,
        r"SOFTWARE\Reality Pump\TwoWorlds\Mods")
  winreg.SetValueEx(key, "MeinMod.wd", 0, winreg.REG_DWORD, 1)
  winreg.CloseKey(key)


SCHRITT 6 — Spielen
────────────────────
IMMER ein neues Spiel starten! Bestehende Spielstände laden
die alten Maps aus dem Savegame — Änderungen wären unsichtbar.


FEHLERBEHEBUNG
──────────────
Problem                          Lösung
───────────────────────────────  ────────────────────────────────
Spiel crasht beim Laden         .phx wurde komprimiert → Nur
                                Buglords wdio.py/Repacker nutzen

Map lädt ohne Änderungen        Neues Spiel starten, nicht laden

Mod wird nicht erkannt           Registry-Eintrag prüfen (=1?)
                                .wd liegt im Mods\ Ordner?

Keine Kollision auf Terrain     PhysX nicht gekocht → Schritt 1

Gebäude/NPCs fehlen auf Map     LevelHeaders veraltet → Schritt 2
                                neu generieren

Minimap zeigt alte Map           .bmp nicht kopiert/umbenannt

"Input is not an existing        Beim Repacker den ORDNER als
 folder" im Repacker             Source wählen, nicht die .wd!


TECHNISCHE DETAILS
──────────────────
WD-Archivformat (Version 0x200 / TW1):
  • Komprimierter Header: 0xFFA1D031 + "WD" + Version + 128bit GUID
  • Verzeichnis am Ende der Datei (zlib-komprimiert)
  • Jede Datei hat: Pfad, Flags, Offset, komprimierte/unkomprimierte Größe
  • Flags bestimmen Kompression: 0x01 = komprimiert, 0x00 = raw
  • .phx-Dateien werden IMMER unkomprimiert gespeichert (Flags=0)
  • GUID identifiziert das Archiv eindeutig

Registry-Mechanismus (aus Buglords Mod Selector ASM-Quellcode):
  • RegCreateKeyExA öffnet HKCU\SOFTWARE\Reality Pump\TwoWorlds\Mods
  • Jeder .wd-Dateiname ist ein Value-Name (REG_DWORD)
  • Das Spiel prüft beim Start welche Mods auf 1 stehen
  • Mod Selector toggelt per Enter zwischen 0 und 1

================================================================================
  Quellen: JadetheReaper (Discord TW Community), Buglord (wdio.py, Mod Selector)
  Zusammengestellt für den TW Editor CMD Injector
================================================================================
