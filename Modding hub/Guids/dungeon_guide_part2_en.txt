================================================================================
  TWO WORLDS 1 — Dungeon Creation Guide  ·  Part 2: SDK Dungeon Editor
================================================================================

OVERVIEW
────────
The TwoWorlds SDK (version 1.3) ships with a dedicated Dungeon Editor — a
standalone tool separate from the main TwoWorldsEditor.exe. This tool was
used by the original developers at Reality Pump to create all dungeons and
caves found in the vanilla game.

The Dungeon Editor works on a block-based grid system. You design your
dungeon layout by placing, configuring and connecting blocks, then the
editor generates a console script that you import into the main
TwoWorlds Editor to create the actual underground level geometry.

The workflow in short:

  Dungeon Editor  →  Design layout (blocks, heights, types, objects)
                  →  Generate console script (F5)
                  →  Open TwoWorldsEditor on an empty underground level
                  →  Execute the generated script
                  →  Run @edundgr.txt to finalize terrain
                  →  Manually place additional objects & markers
                  →  Connect to surface level (Upper/Lower linking)


REQUIREMENTS
────────────
• TwoWorldsSDK installed (e.g. at C:\Games\TwoWorldsSDK\)
• The Dungeons folder inside the SDK contains:
    - The Dungeon Editor executable
    - Sample data in the Dungeons\ subdirectory
    - *scr.txt files (console scripts for use in the main editor)
    - dungeon.txt (configuration file for block types and objects)
• TwoWorldsEditor.exe (the main level editor, also in the SDK)
• Two Worlds Epic Edition (for testing)
• The Game\ directory from the SDK must be copied to your game directory
  (contains console scripts the editor needs)


FOLDER STRUCTURE
────────────────
SDK Dungeons directory:

  TwoWorldsSDK\
  ├── Dungeons\
  │   ├── Dungeons\          ← Sample dungeon data
  │   │   ├── dungeon.txt    ← Configuration file (block types, objects)
  │   │   └── (sample files)
  │   └── *scr.txt           ← Pre-made console scripts for the editor
  ├── Tools\
  │   └── TwoWorldsEditor.exe
  └── Game\
      └── (console scripts — copy these to your game directory)


================================================================================
  SECTION 1 — KEYBOARD CONTROLS
================================================================================

The Dungeon Editor uses simple keyboard and mouse controls. All major
functions are mapped to function keys.

  Key              Function
  ───────────────  ─────────────────────────────────────────────────
  Tab              Cycle to next editor mode
                   The editor has 4 main modes that you cycle through:
                     1. Setting Dungeons Mode  (block layout)
                     2. Setting Height Mode    (vertical positioning)
                     3. Setting Dungeons Type  (visual style/tileset)
                     4. Setting Objects Mode   (prop placement)
                   Each press of Tab advances to the next mode.

  F2               Save dungeon to file
                   Saves the current dungeon design to disk so you can
                   continue working on it later.

  F3               Load dungeon from file
                   Opens a previously saved dungeon design file.

  F4               Set offset for map
                   Defines the position offset where the dungeon will
                   be placed on the underground level. This controls
                   where on the level grid the dungeon blocks will be
                   generated when the console script is executed.

  F5               Generate console script for editor
                   This is the key output step. The Dungeon Editor
                   converts your entire design into a text-based
                   console script (.txt) that can be executed inside
                   the main TwoWorldsEditor using the @ command.
                   This script contains all the commands needed to
                   build the dungeon geometry on an underground level.

  F6               Load "old" dungeon
                   Loads a dungeon in an older/legacy format. Useful
                   if you want to inspect or modify one of the original
                   vanilla dungeons that were created before the SDK
                   was finalized.

  F8               Reset everything
                   Clears the entire dungeon design and returns the
                   editor to a blank state. Use with caution — this
                   cannot be undone.

  Escape           Exit / Close the editor
                   Closes the Dungeon Editor application.

  Page Up          Zoom in
  Page Down        Zoom out
                   Controls the zoom level of the 2D dungeon view.

  Arrow Keys       Pan / scroll the view
                   Moves the camera across the dungeon grid so you
                   can navigate large layouts.


================================================================================
  SECTION 2 — MODE 1: SETTING DUNGEONS MODE  (Block Layout)
================================================================================

This is the primary design mode where you create the dungeon's floor
plan by placing and removing blocks on a 2D grid.

CONTROLS
────────
  Left Mouse Button    Place / draw a block at the cursor position
  Right Mouse Button   Remove a block at the cursor position

Blocks are the fundamental building units of a dungeon. Each block
represents a section of dungeon geometry (a room, corridor, junction,
etc.). Blocks snap to the grid and must connect properly to their
neighbors.

BLOCK VARIANTS
──────────────
Many blocks have multiple visual variants (different shapes or
configurations for the same grid position). If a block has more than
one version available, you can cycle through the variants by left-
clicking on an already placed block. This lets you fine-tune which
specific geometry piece is used at each position.

ERROR INDICATORS
────────────────
The editor uses a color-coded system to highlight problems in your
layout. You must resolve all errors before generating a valid console
script.

  Color           Meaning                     How to Fix
  ──────────────  ──────────────────────────  ─────────────────────────
  Red             Invalid block               The editor cannot find a
                  configuration.              valid set of blocks for
                  No matching block set       this position. Try a
                  exists for this position.   different variant (click
                                              to cycle) or rearrange
                                              neighboring blocks.

  Green           Hole in the layout.         There is a gap where a
                  Blocks must be added.       block is required for the
                                              dungeon to be structurally
                                              complete. Add a block to
                                              fill the hole.

  Blue / Violet   Block overlap.              Two blocks (e.g. two H-
                  A block is set on top       shaped blocks) are
                  of another block.           occupying the same space.
                                              One of them must be moved
                                              or removed to resolve the
                                              conflict.

TIP: Work outward from a central point. Place your main rooms first,
then connect them with corridors. Check for errors frequently — it is
easier to fix problems as they appear than to debug a large layout
all at once.


================================================================================
  SECTION 3 — MODE 2: SETTING HEIGHT MODE  (Vertical Positioning)
================================================================================

Once your block layout is complete, switch to Height Mode (press Tab)
to control the vertical elevation of each block. This allows you to
create multi-level dungeons with stairs, ramps, and height transitions.

CONTROLS
────────
  Left Mouse Button    Click on a block to cycle through its height
                       variants. Each click advances to the next
                       available height value.

READING THE DISPLAY
───────────────────
Each block displays a numeric value representing its height (elevation
level). The text color tells you whether the block can change height:

  Text Color      Meaning
  ──────────────  ──────────────────────────────────────────────────
  White           Fixed height — this block does not support height
                  changes. Its elevation is locked to its current
                  value based on the block type.

  Yellow          Variable height — this block supports height
                  changes. Click to cycle through the available
                  height values. Use yellow blocks to create
                  elevation transitions (stairs, slopes, ramps).

ERROR INDICATORS
────────────────
  Color           Meaning                     How to Fix
  ──────────────  ──────────────────────────  ─────────────────────────
  Violet          Height mismatch at a        Two adjacent blocks have
                  block joint, OR the         incompatible heights at
                  dungeon exceeds the         their connection point.
                  maximum allowed height.     Change the block variant
                                              or height value of one
                                              of the neighboring blocks
                                              until the violet marking
                                              disappears.
                                              If the dungeon is too
                                              tall overall, lower some
                                              blocks to bring the total
                                              height within limits.

DESIGN TIPS
───────────
• Adjacent blocks must have matching heights at their connection
  points, or the geometry will not connect properly in-game.

• Plan your elevation changes in advance. It helps to sketch a
  rough side-view diagram showing which areas are high and low
  before committing to height values.

• Use yellow (variable) blocks at transition points to bridge
  between different elevation levels.

• The game engine has a maximum dungeon height. If you see violet
  errors and you haven't created mismatches, your dungeon may be
  too tall — reduce the height of your highest blocks.


================================================================================
  SECTION 4 — MODE 3: SETTING DUNGEONS TYPE MODE  (Visual Style)
================================================================================

This mode lets you assign a visual theme (tileset) to each block or
group of blocks in your dungeon. Different dungeon types use different
geometry, textures, and lighting — for example "DUN" for stone dungeon
walls or "CAVE" for natural cave formations.

CONTROLS
────────
  Left Mouse Button    Select a single block
  Right Mouse Button   Select a group of blocks (area selection)
  Mouse Wheel          Cycle through available dungeon types

VISUAL FEEDBACK
───────────────
Selected blocks are colored according to the dungeon type assigned to
them. Each dungeon type has its own RGB color defined in the
dungeon.txt configuration file (see Section 6). This makes it easy
to see at a glance which parts of your dungeon use which tileset.

AVAILABLE DUNGEON TYPES
───────────────────────
The dungeon types are defined in the dungeon.txt configuration file.
Each type specifies:

  • A blocks group name (e.g. "DUN", "CAVE")
  • A blocks group number (e.g. "01", "07b")
  • A display color for the editor
  • Which object addon groups are available for that type

The vanilla SDK ships with several pre-defined dungeon types. You can
also create your own by editing the dungeon.txt configuration file
(see Section 6 for the full syntax).

MIXING TYPES
────────────
You can assign different dungeon types to different blocks within the
same dungeon. This allows you to create dungeons that transition from
one visual style to another — for example, a stone dungeon entrance
that opens into a natural cave system deeper inside.

Be aware that transitions between different types may not always look
seamless. Test mixed-type dungeons in-game to check for visual
artifacts at the boundaries.


================================================================================
  SECTION 5 — MODE 4: SETTING OBJECTS MODE  (Prop Placement)
================================================================================

The Objects Mode allows you to place decorative objects, light sources,
and other props within your dungeon. The available objects are defined
in the dungeon.txt configuration file as "Addons" groups.

CONTROLS
────────
  Left Mouse Button              Insert an object at cursor position
                                 Places the currently selected object
                                 type at the mouse position within the
                                 dungeon grid.

  Left Mouse Button + Ctrl       Pick up object type
                                 "Eye-dropper" function — click on an
                                 existing placed object to make its type
                                 the currently selected type. Useful for
                                 quickly selecting a type that is already
                                 in your dungeon without scrolling through
                                 the object list.

  Left Mouse Button + Shift      Remove last inserted object
                                 Undo for object placement — removes the
                                 most recently placed object.

  Left Mouse Button + Shift      Remove ALL objects of the currently
  + Ctrl                         selected type. Use with caution — this
                                 affects every instance of that object
                                 type in the entire dungeon.

  Mouse Wheel                    Change object type
                                 Scroll to cycle through the available
                                 object types. The available objects
                                 depend on which Addons groups are
                                 assigned to the current dungeon type.

OBJECT PROPERTIES
─────────────────
Each object in the dungeon.txt config has these properties:

  Property      Description
  ────────────  ──────────────────────────────────────────────────
  Name          Display name shown in the editor
  ObjectID      The parameter ID from Two Worlds' data — this links
                the editor object to the actual game object
  MeshType      The type of 3D mesh used to represent the object
  Bitmap        The 2D image drawn in the editor view to represent
                the object (since the Dungeon Editor is 2D)
  Range         Light range — if not 0, this object is treated as a
                light source with the specified range
  R G B         Light color (only used if Range > 0) — defines the
                color of the light emitted by this object

LIGHTING OBJECTS
────────────────
Objects with a Range value greater than 0 are treated as light sources.
When placed, they will emit light with the specified color and range
in-game. This is how you illuminate your dungeon — place torches,
braziers, magical crystals, or other light-emitting objects throughout
the space to ensure visibility.

TIP: Dungeons are completely dark without light sources. Place lights
generously, especially near important areas like intersections,
treasure locations, and entrance/exit points. Consider the mood you
want to create — sparse lighting creates tension, dense lighting
makes the space feel safer and more inviting.


================================================================================
  SECTION 6 — CONFIGURATION FILE: dungeon.txt
================================================================================

The dungeon.txt file is the heart of the Dungeon Editor's content
system. It defines which dungeon types exist, what visual blocks they
use, and which objects can be placed in them. This file is located in
the Dungeons\ subdirectory of the SDK.

The file has two types of definitions: Addons (object groups) and
Dungeon (dungeon type definitions).


ADDONS DEFINITION — Object Groups
──────────────────────────────────
Addons define groups of placeable objects. Each group contains one or
more objects that share a thematic purpose (e.g. "Torches", "Barrels",
"Cave Formations").

  Syntax:

  Addons GroupName {

      Name1 ObjectID1 MeshType1 Bitmap1 Range1 [R G B]
      Name2 ObjectID2 MeshType2 Bitmap2 Range2 [R G B]
      ...

  }

  Field breakdown:

  ┌─────────────┬──────────────────────────────────────────────────┐
  │ Field       │ Description                                      │
  ├─────────────┼──────────────────────────────────────────────────┤
  │ GroupName   │ Name of this addons group. This name is          │
  │             │ referenced in Dungeon definitions to make these  │
  │             │ objects available for a dungeon type.             │
  ├─────────────┼──────────────────────────────────────────────────┤
  │ NameX       │ Display name of the individual object, shown     │
  │             │ in the editor when scrolling through objects.     │
  ├─────────────┼──────────────────────────────────────────────────┤
  │ ObjectIDX   │ Parameter ID linking this object to its game     │
  │             │ definition in TwoWorlds.par. This determines     │
  │             │ what the object actually IS in-game.              │
  ├─────────────┼──────────────────────────────────────────────────┤
  │ MeshTypeX   │ The mesh type used for rendering the object.     │
  │             │ Controls which 3D model variant is used.          │
  ├─────────────┼──────────────────────────────────────────────────┤
  │ BitmapX     │ Filename of the 2D bitmap drawn in the editor    │
  │             │ to represent this object. Since the Dungeon       │
  │             │ Editor is a 2D top-down view, objects are shown   │
  │             │ as icons/bitmaps rather than 3D models.           │
  ├─────────────┼──────────────────────────────────────────────────┤
  │ RangeX      │ Light range. If set to 0, the object has no      │
  │             │ light. If set to any positive value, the object   │
  │             │ acts as a light source with that range.           │
  ├─────────────┼──────────────────────────────────────────────────┤
  │ [R G B]     │ Optional. Light color in RGB (0-255 per channel).│
  │             │ Only meaningful if Range > 0. If omitted, a       │
  │             │ default light color is used.                      │
  └─────────────┴──────────────────────────────────────────────────┘

  Example (hypothetical):

  Addons DungeonLights {

      WallTorch    OBJ_TORCH_WALL_01   3  torch_icon.bmp   12  255 200 100
      FloorBrazier OBJ_BRAZIER_01      2  brazier_icon.bmp  8  255 150  50
      MagicCrystal OBJ_CRYSTAL_GLOW_01 1  crystal_icon.bmp 16   50 100 255

  }

  This defines a group called "DungeonLights" with three light-emitting
  objects: a wall torch (warm light, range 12), a floor brazier (orange
  light, range 8), and a magic crystal (blue light, range 16).


DUNGEON DEFINITION — Dungeon Types
───────────────────────────────────
Dungeon definitions describe the available dungeon themes/tilesets.
Each dungeon type links to a specific set of geometry blocks and
specifies which Addons groups are available for object placement.

  Syntax:

  Dungeon TypeName BlocksName BlocksNumber R G B {

      AddonsGroup1
      AddonsGroup2
      ...

  }

  Field breakdown:

  ┌──────────────┬─────────────────────────────────────────────────┐
  │ Field        │ Description                                     │
  ├──────────────┼─────────────────────────────────────────────────┤
  │ TypeName     │ Display name of this dungeon type. Shown in the │
  │              │ editor when cycling through types with the       │
  │              │ mouse wheel in Dungeons Type Mode.               │
  ├──────────────┼─────────────────────────────────────────────────┤
  │ BlocksName   │ Name of the geometry blocks group to use.       │
  │              │ The vanilla game uses names like "DUN" for       │
  │              │ dungeon blocks and "CAVE" for cave blocks.       │
  │              │ This refers to the 3D geometry sets that define  │
  │              │ the walls, floors, ceilings, and transitions.    │
  ├──────────────┼─────────────────────────────────────────────────┤
  │ BlocksNumber │ The specific variant number within the blocks   │
  │              │ group. Examples: "01", "07b". Different numbers  │
  │              │ correspond to different visual styles within the │
  │              │ same category (e.g. different cave formations    │
  │              │ or different dungeon stone textures).             │
  ├──────────────┼─────────────────────────────────────────────────┤
  │ R G B        │ Editor display color for this dungeon type.     │
  │              │ Values from 0 to 255 per channel. When blocks   │
  │              │ are assigned this type in Dungeons Type Mode,    │
  │              │ they are painted in this color for easy visual   │
  │              │ identification.                                   │
  ├──────────────┼─────────────────────────────────────────────────┤
  │ AddonsGroupX │ Names of Addons groups available for this       │
  │              │ dungeon type. When working in Objects Mode on    │
  │              │ blocks of this type, only objects from the listed│
  │              │ Addons groups can be placed. You can list        │
  │              │ multiple groups to combine object sets.           │
  └──────────────┴─────────────────────────────────────────────────┘

  Example (hypothetical):

  Dungeon StoneDungeon DUN 01 180 180 200 {

      DungeonLights
      DungeonFurniture
      DungeonTraps

  }

  Dungeon NaturalCave CAVE 07b 100 150 100 {

      CaveLights
      CaveFormations
      CaveCreatures

  }

  The first definition creates a dungeon type called "StoneDungeon"
  using geometry from the "DUN" blocks group variant "01", displayed
  as light blue in the editor, with access to lights, furniture, and
  trap objects.

  The second creates "NaturalCave" using "CAVE" blocks variant "07b",
  displayed as greenish in the editor, with cave-specific objects.


EDITING TIPS
────────────
• Always study the existing dungeon.txt that ships with the SDK before
  making changes. The sample data shows you which BlocksNames and
  BlocksNumbers are available.

• Back up dungeon.txt before editing. A syntax error can prevent the
  Dungeon Editor from loading.

• Object IDs (ObjectIDX) must match valid entries in the game's
  parameter system. Check TwoWorlds.par or TwoWorlds.xls in the
  SDK's Parameters folder for valid object IDs.

• You can create new Addons groups to organize custom object
  collections, then reference them in multiple Dungeon definitions.


================================================================================
  SECTION 7 — CREATING THE LEVEL (From Editor to Game)
================================================================================

This section describes the complete workflow from finished dungeon
design to playable underground level.


STEP 1 — Generate the Console Script
─────────────────────────────────────
When your dungeon design is complete in the Dungeon Editor (all errors
resolved in all four modes), press F5 to generate the console script.

This creates a .txt file containing all the editor console commands
needed to construct the dungeon geometry, set heights, assign types,
and place objects on a level in the main TwoWorldsEditor.

Before generating, use F4 to set the map offset if needed. This
determines where on the underground level grid the dungeon geometry
will be positioned.


STEP 2 — Prepare an Empty Underground Level
────────────────────────────────────────────
Open TwoWorldsEditor.exe and create a new level:

  1. File → New
  2. Go to Tools → Properties
  3. Set the Level Name and Level File Name
  4. Check the "Underground Level" checkbox
  5. Set the appropriate map Size (Medium = 128x128 is standard)
  6. Click OK

The level must be a fresh, empty underground level. The generated
script expects a blank canvas to work with.


STEP 3 — Execute the Generated Script
──────────────────────────────────────
Open the console in the TwoWorldsEditor (press C key) and execute the
generated script:

  @your_dungeon_script.txt

Replace "your_dungeon_script.txt" with the actual filename generated
by the Dungeon Editor in Step 1.

The editor will process all the commands in the script file. This may
take a moment depending on the dungeon's complexity. When complete,
you should see the dungeon geometry appear on the underground level.


STEP 4 — Run the Underground Finalization Script
─────────────────────────────────────────────────
After the dungeon geometry is in place, you must run the underground
finalization script to properly set up the terrain colors and disable
inaccessible areas.

First, initialize all underground levels with white color (if working
with multiple levels):

  Editor.foreachundergroundlevel Editor.FillWorldWithColor 0xFFFFFFFF

Then execute the underground finalization script:

  @edundgr.txt

This script performs the following operations in sequence:

  1. Editor.ReplaceColor 0xFF000000 0xFFFFFFFF
     Replaces all black terrain color with white. This is a reset
     step to ensure consistent starting colors.

  2. editor.LabelNotDisabledPassableFromMarkers
       MARKER_TELEPORT_DEST_FROMUPPER MARKER_TELEPORT_DEST_FROMLOWER
     Marks all terrain that is reachable from the teleport destination
     markers (dungeon entrance/exit points) as passable. Everything
     NOT reachable from these markers will be considered inaccessible.

  3. Editor.ReplaceColorOnDisabledTerrain 0xFFFFFFFF 0xFF000000 4
     Paints all inaccessible (disabled) terrain black. This creates
     the visual effect of darkness/void in areas the player cannot
     reach — the standard look for underground levels in Two Worlds.

  4. editor.savelevel
     Saves the level with all changes applied.

IMPORTANT: For step 2 to work correctly, you need teleport destination
markers (MARKER_TELEPORT_DEST_FROMUPPER and/or
MARKER_TELEPORT_DEST_FROMLOWER) already placed on the level. These
markers define the entry/exit points of your dungeon. If they are
missing, the script cannot determine which areas are accessible and
may disable the entire level or produce unexpected results.

If you need to run the finalization on ALL underground levels at once:

  Editor.foreachundergroundlevel @edundgr.txt


STEP 5 — Manually Fill the Dungeon
───────────────────────────────────
The generated dungeon script creates the geometry framework, but the
level still needs manual work in the TwoWorldsEditor to be complete:

  • Place entrance/exit markers and props
    - On the surface level: Cave Entrance prop + Dest_from_lower marker
    - In the dungeon: Cave Exit prop + Dest_from_upper marker
    - Set the Upper/Lower connection in Tools → Properties

  • Place enemy spawner markers
    Use spawner markers (e.g. "animal spawner 2" etc.) rather than
    placing NPC models directly. Direct model placement results in
    static NPCs that won't act or move unless attacked.
    Spawner markers generate 2-6 enemies per marker (1-3 for giants
    or tough enemies).

  • Place chests and loot containers
    Chests can be opened by the player once placed. Loot is randomized
    based on the player's character level.

  • Place additional decorative objects
    Furniture, rubble, bones, cobwebs, etc. to bring the dungeon to
    life.

  • Place light sources if not already done via the Dungeon Editor
    Remember: dungeons are completely dark without lights.

  • Update terrain passing (Alt+U) and walkable objects (Alt+W)
    This ensures NPCs can navigate properly and collision works.


STEP 6 — Cook PhysX and Finalize
─────────────────────────────────
Before the dungeon can work in-game, you must cook the physics data.
Open the console (C key) in the editor and run:

  editor.cookphysx.mode geomipmap
  editor.cookphysx.strength = 1.0
  editor.cookphysx.overwrite = 1
  editor.cookphysx.pc out

Then follow the standard Map-to-Mod workflow (see the Map to Mod
Conversion Guide) to pack the underground level into a .wd archive
alongside your surface level.


================================================================================
  SECTION 8 — ADDITIONAL UNDERGROUND CONSOLE COMMANDS
================================================================================

These console commands from the SDK documentation are useful when
working with underground levels, either created via the Dungeon Editor
or built manually.

TERRAIN COLOR COMMANDS
──────────────────────
  Editor.FillWorldWithColor 0xFFFFFFFF
    Fills the entire level terrain with the specified color.
    0xFFFFFFFF = white, 0xFF000000 = black.
    Typically used to initialize underground levels to white before
    the finalization script processes them.

  Editor.ReplaceColor oldColor newColor
    Replaces all terrain of oldColor with newColor.
    Example: Editor.ReplaceColor 0xFF000000 0xFFFFFFFF
    (Replace all black with white)

  Editor.ReplaceColorOnDisabledTerrain oldColor newColor range
    Replaces terrain color only on disabled (inaccessible) terrain.
    The range parameter controls the edge blending distance.
    Example: Editor.ReplaceColorOnDisabledTerrain 0xFFFFFFFF 0xFF000000 4

PASSABILITY COMMANDS
────────────────────
  editor.LabelNotDisabledPassableFromMarkers MARKER1 MARKER2 ...
    Marks terrain as passable if it is reachable from the specified
    marker types. All terrain NOT reachable from these markers
    becomes disabled. This is the core command for defining which
    areas of an underground level the player can actually walk on.
    Typical markers: MARKER_TELEPORT_DEST_FROMUPPER
                     MARKER_TELEPORT_DEST_FROMLOWER

  Editor.ClearDisabled
    Clears all disabled-terrain flags, making all terrain accessible
    again. Useful if you need to reset and re-run the passability
    calculation.

BATCH EXECUTION COMMANDS
────────────────────────
  Editor.foreachundergroundlevel @script.txt
    Executes the specified script on every underground level.
    This is how you apply the finalization script to all dungeons
    in a multi-level project.

  Editor.foreachsurfacelevel @script.txt
    Same concept, but for surface (overworld) levels.

  editor.savelevel
    Saves the current level. Often placed at the end of batch scripts
    to ensure changes are persisted.

  editor.savelevel 0
    Variant that saves with specific flags.


================================================================================
  SECTION 9 — REFERENCE: edundgr.txt
================================================================================

The edundgr.txt script is a critical part of the underground level
finalization pipeline. For reference, here is the complete script
content and what each line does:

  ┌─────────────────────────────────────────────────────────────────┐
  │ File: edundgr.txt                                               │
  ├─────────────────────────────────────────────────────────────────┤
  │                                                                 │
  │ Editor.ReplaceColor 0xFF000000 0xFFFFFFFF                       │
  │   → Reset: replace all black with white                         │
  │                                                                 │
  │ editor.LabelNotDisabledPassableFromMarkers                      │
  │     MARKER_TELEPORT_DEST_FROMUPPER                              │
  │     MARKER_TELEPORT_DEST_FROMLOWER                              │
  │   → Calculate passability from teleport markers                 │
  │                                                                 │
  │ Editor.ReplaceColorOnDisabledTerrain 0xFFFFFFFF 0xFF000000 4    │
  │   → Paint all inaccessible terrain black (with 4-unit blending) │
  │                                                                 │
  │ editor.savelevel                                                │
  │   → Save the level                                              │
  │                                                                 │
  └─────────────────────────────────────────────────────────────────┘

To run on a single underground level:
  @edundgr.txt

To run on all underground levels:
  Editor.foreachundergroundlevel @edundgr.txt

To initialize all underground levels before first run:
  Editor.foreachundergroundlevel Editor.FillWorldWithColor 0xFFFFFFFF


================================================================================
  SECTION 10 — TROUBLESHOOTING
================================================================================

Problem                           Solution
────────────────────────────────  ──────────────────────────────────────
Dungeon Editor won't start        Ensure the Dungeons\ subdirectory
                                  with sample data and dungeon.txt is
                                  present. Check that all required DLLs
                                  from the game directory are accessible
                                  (add game dir to system PATH).

Red blocks in Dungeons Mode       Invalid block configuration. Try
                                  cycling the block variant (left-click)
                                  or rearranging neighboring blocks.

Green blocks in Dungeons Mode     Holes in the layout. Add blocks to
                                  fill all gaps. Every space between
                                  existing blocks must be filled.

Violet blocks in Height Mode      Height mismatch at block joints.
                                  Change the height variant of one
                                  of the mismatched blocks. Also check
                                  if total dungeon height exceeds limit.

Generated script produces no      Make sure the target level is set as
geometry in the main editor       "Underground Level" in Properties.
                                  Check that the script file path is
                                  correct when using @filename.txt.

Player falls through dungeon      PhysX not cooked. Run the cookphysx
floor in-game                     commands (Section 7, Step 6). Make
                                  sure the .phx file is uncompressed
                                  in the .wd archive.

Entire dungeon is black /         Teleport markers missing. Place
inaccessible after edundgr.txt    MARKER_TELEPORT_DEST_FROMUPPER and/or
                                  MARKER_TELEPORT_DEST_FROMLOWER before
                                  running the finalization script.
                                  Then re-run @edundgr.txt.

Dungeon loads but has no          Place light-emitting objects (torches,
visibility                        braziers, crystals). Dungeons have no
                                  ambient light by default.

Objects from Addons groups not    Check dungeon.txt syntax. Ensure the
appearing in Objects Mode         Addons group name exactly matches the
                                  reference in the Dungeon definition.
                                  Check for typos and missing braces.

Cannot load old dungeon (F6)      The old format may be incompatible
                                  with the SDK version. Try creating
                                  a new dungeon from scratch based on
                                  the old design as reference.


================================================================================
  SECTION 11 — QUICK REFERENCE CARD
================================================================================

DUNGEON EDITOR KEYS
────────────────────
  Tab ............. Next mode
  F2 .............. Save
  F3 .............. Load
  F4 .............. Set map offset
  F5 .............. Generate script
  F6 .............. Load old dungeon
  F8 .............. Reset all
  Esc ............. Exit
  PgUp/PgDn ....... Zoom
  Arrows .......... Pan

MODE 1: DUNGEONS (Layout)
─────────────────────────
  LMB ............. Place block
  RMB ............. Remove block
  LMB on block .... Cycle variant
  Errors: Red=invalid  Green=hole  Blue/Violet=overlap

MODE 2: HEIGHT (Elevation)
──────────────────────────
  LMB on block .... Cycle height variant
  White text ...... Fixed height
  Yellow text ..... Variable height
  Errors: Violet=mismatch or too tall

MODE 3: TYPE (Tileset)
──────────────────────
  LMB ............. Select single block
  RMB ............. Select group
  Wheel ........... Change type
  Colors = dungeon type colors from dungeon.txt

MODE 4: OBJECTS (Props)
───────────────────────
  LMB ............. Place object
  Ctrl+LMB ........ Pick type from existing
  Shift+LMB ....... Remove last placed
  Shift+Ctrl+LMB .. Remove all of selected type
  Wheel ........... Change object type


================================================================================
  Sources: Reality Pump SDK 1.3 Documentation (Dungeons readme.txt,
           _info_.txt, Editor console.txt)
  Compiled for the TW Editor community documentation project
================================================================================
